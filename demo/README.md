# Akeyless Universal Identity Demo

This directory contains hands-on demonstrations of Universal Identity token management capabilities following the **realistic workflow diagram personas**.

## ğŸ­ Persona Workflow Diagram

```mermaid
sequenceDiagram
    participant A as ğŸ§‘â€ğŸ’¼ Admin
    participant P as ğŸ‘· Platform Engineer  
    participant AS as ğŸš€ Application Service
    participant S as ğŸ¢ Akeyless SaaS

    Note over A,S: Initial Setup (One-time)
    A->>S: 1. Create UID Auth Method
    S->>A: 2. SaaS ACK
    A->>S: 3. Generate initial UID token
    S->>A: 3b. Return UID token
    
    Note over P,AS: Deployment (Per Service)
    A->>P: Hand off tokens
    P->>AS: Deploy token to service
    P->>AS: Set up automated rotation
    
    Note over AS,S: Autonomous Operations (Ongoing)
    AS->>S: 4. Auth with UID token
    S->>AS: 5. Response with JWT (t-token)
    AS->>S: 6. Use t-token for database secrets
    
    Note over AS,S: Self-Rotation Cycle
    AS->>S: 7. Rotate UID token
    S->>AS: 8. Return ACK + new UID token
    AS->>S: 9. Auth with new UID token
    
    Note over AS: Child Token Management
    AS->>AS: Create child tokens for microservices
    AS->>AS: Manage hierarchical service identity
```

## ğŸš€ Quick Start: Persona-Based Workflow

### ğŸ¬ Using start.sh (Recommended)
```bash
# Run the interactive demo menu
./start.sh
```

The interactive script provides:
- **ğŸ¯ Complete Three-Persona Workflow**: Automated progression through all personas
- **ğŸ­ Individual Persona Selection**: Choose specific steps to run
- **ğŸ Python Integration Example**: Real-world secretless authentication demo
- **ğŸ“Š Real-time Status Tracking**: See which components are complete
- **âš ï¸ Prerequisites Validation**: Checks environment variables
- **ğŸ”„ Smart Workflow Management**: Skips completed steps, enforces dependencies
- **ğŸŒˆ Color-coded Interface**: Easy-to-follow visual experience

**Menu Options:**
1. **Complete Workflow** (Recommended for first-time users)
2. **Individual Steps** (For learning specific personas)
3. **Advanced Features** (Token rotation, hierarchical management, Python integration)
4. **Status Monitoring** (Check current workflow state)

### ğŸ§‘â€ğŸ’¼ Admin Persona (Steps 1-3)
```bash
# Admin sets up environment and provisions application service
./scripts/admin-setup.sh
```

### ğŸ‘· Platform Engineer Persona (Deployment)  
```bash
# Platform Engineer deploys to application services and sets up automation
./scripts/platform-deploy.sh
```

### ğŸš€ Application Service Persona (Steps 4-9)  
```bash
# Application Service uses deployed token for autonomous operations
./scenarios/client-workflow.sh
```

### ğŸ”„ Additional Scenarios
```bash
# Explore hierarchical token management
./scenarios/child-tokens.sh

# Python integration example (secretless authentication)
python3 ./examples/machine-auth.py
```

### ğŸ”„ Legacy Demo (All-in-One - Educational Only)
```bash
# Mixed admin/client operations for learning purposes
# Note: basic-workflow.sh and setup-demo-environment.sh have been removed
# Use start.sh for the complete guided three-persona workflow
./start.sh
```

## ğŸ“‹ Workflow Diagram Alignment

Our demo now properly follows the workflow diagram personas:

| Step | Persona | Action | Demo Script |
|------|---------|--------|-------------|
| 1-2 | ğŸ§‘â€ğŸ’¼ Admin | Creates UID Auth method + Akeyless SaaS Ack | `admin-setup.sh` |
| 3 | ğŸ§‘â€ğŸ’¼ Admin | Generates initial UID token & loads in application | `admin-setup.sh` |
| Deploy | ğŸ‘· Platform Engineer | Deploys token to application service + sets up automation | `platform-deploy.sh` |
| 4 | ğŸš€ Application Service | Runs auth command using UID init token | `client-workflow.sh` |
| 5 | ğŸ¢ SaaS | Response with JWT (t-token) | `client-workflow.sh` |
| 6 | ğŸš€ Application Service | Runs commands using t-token | `client-workflow.sh` |
| 7 | ğŸš€ Application Service | Rotates UID using u-token | `client-workflow.sh` |
| 8 | ğŸ¢ SaaS | Returns ACK + new u-token | `client-workflow.sh` |
| 9 | ğŸš€ Application Service | Runs auth command with new u-token | `client-workflow.sh` |

## ğŸ“ Demo Structure

```
demo/
â”œâ”€â”€ scripts/                       # Human persona operations
â”‚   â”œâ”€â”€ admin-setup.sh              # ğŸ§‘â€ğŸ’¼ Admin persona (steps 1-3)
â”‚   â”œâ”€â”€ platform-deploy.sh          # ğŸ‘· Platform Engineer (deployment)
â”‚   â”œâ”€â”€ application-service-rotate.sh # ğŸš€ Auto-generated by platform-deploy.sh
â”‚   â””â”€â”€ (rotation scripts removed - using application-service-rotate.sh)
â”œâ”€â”€ scenarios/                     # Application Service operations
â”‚   â”œâ”€â”€ client-workflow.sh          # ğŸš€ Application Service persona with rotation (steps 4-9)
â”‚   â””â”€â”€ child-tokens.sh            # ğŸš€ Application Service hierarchical management
â”œâ”€â”€ tokens/                        # Token storage
â”‚   â”œâ”€â”€ client-tokens               # ğŸ§‘â€ğŸ’¼ Admin-generated tokens
â”‚   â”œâ”€â”€ application-service-token   # ğŸ‘· Platform Engineer deployed tokens
â”‚   â””â”€â”€ demo-tokens                # LEGACY: Mixed-persona storage
â”œâ”€â”€ logs/                          # Application Service logs
â”‚   â””â”€â”€ rotation.log               # Automated rotation logging
â”œâ”€â”€ start.sh                       # ğŸ¬ Interactive demo entry point
â””â”€â”€ examples/                      # Real-world integration examples
    â””â”€â”€ machine-auth.py            # ğŸ Python secretless authentication example
```

## ğŸ­ Realistic Persona Workflow

### ğŸ‘¨â€ğŸ’¼ Admin Setup (One-time)

**Prerequisites:** Admin credentials required
```bash
export AKEYLESS_ACCESS_ID="your-admin-access-id"
export AKEYLESS_ACCESS_KEY="your-admin-access-key"
```

**Admin tasks:**
1. Create UID authentication method
2. Configure secrets and access policies  
3. Generate initial UID token for application service
4. Provision token to platform engineer

```bash
./scripts/admin-setup.sh
```

**Output:** `./tokens/client-tokens` file ready for platform engineer

### ğŸ‘· Platform Engineer Setup (Per Service)

**Prerequisites:** Admin-provided token file
```